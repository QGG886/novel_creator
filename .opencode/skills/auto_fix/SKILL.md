---
name: auto_fix
description: 自动修复章节中的各类问题，包括对话、节奏、情感、表达等
metadata:
  language: markdown
  framework: novel-creation
---

# 自动修复Skill

## 功能

批量执行检查Skill提供的修改方案，自动修复章节中的各类问题。

---

## 使用场景

- 接收来自9个检查Skill的修改方案
- 批量执行修复任务
- 逐个应用修改方案
- 输出修复后的完整章节

---

## 输入格式

```json
{
  "修复任务列表": [
    {
      "任务ID": "D-001",
      "来源Skill": "dialogue_check",
      "目标位置": {
        "章节号": 4,
        "段落位置": "第3段",
        "具体内容": "需要修复的具体文本片段"
      },
      "问题描述": "对话过于书面化",
      "修改方案": {
        "方案类型": "替换/调整/增加/删除",
        "具体操作": "将'我非常赞同'替换为'嗯，我同意'",
        "修改后内容": "修改后的完整内容",
        "操作说明": "详细说明如何修改"
      },
      "可自动修复": true
    },
    {
      "任务ID": "R-001",
      "来源Skill": "rhythm_check",
      "目标位置": {...},
      "问题描述": "...",
      "修改方案": {...},
      "可自动修复": true
    }
  ],
  "章节内容": "完整章节内容",
  "上下文": {
    "角色卡": {},
    "文风指南": "文风指南内容（如有）"
  },
  "修复配置": {
    "按优先级": true,
    "最大修复数": 50,
    "跳过不可修复": true
  }
}
```

---

## 输出格式

```json
{
  "状态": "成功",
  "修复摘要": {
    "总任务数": 10,
    "可修复": 8,
    "已修复": 7,
    "修复失败": 1,
    "跳过（不可自动修复）": 2,
    "修复成功率": "87.5%"
  },
  "修复结果列表": [
    {
      "任务ID": "D-001",
      "来源Skill": "dialogue_check",
      "原内容": "修复前的文本",
      "修复后内容": "修复后的文本",
      "修复状态": "已修复",
      "修改说明": "已应用修改方案：将'我非常赞同'替换为'嗯，我同意'",
      "验证结果": {
        "保持原意": true,
        "保持风格": true,
        "保持角色性格": true,
        "前后连贯": true
      }
    },
    {
      "任务ID": "R-001",
      "来源Skill": "rhythm_check",
      "修复状态": "修复失败",
      "失败原因": "目标位置内容已被其他修复修改"
    }
  ],
  "修复后章节": "应用所有修复后的完整章节内容",
  "建议": {
    "是否需要进一步调整": true,
    "后续建议": "建议人工检查D-001的修复效果"
  }
}
```

---

## 修复类型详解

### 1. 对话修复

#### 问题描述示例
- "对话过于书面化"
- "对话缺乏个性"
- "语气不符合情境"
- "对话节奏单一"

#### 修复策略
- **口语化**：将书面语转换为口语表达
  - "我非常赞同你的观点" → "嗯，我同意你的说法"
- **增加语气词**：添加"嗯"、"啊"、"吧"、"呢"等
- **增加停顿**：用省略号、破折号表示停顿
- **个性化**：根据角色性格调整表达方式
  - 粗犷角色：直接、简短
  - 文雅角色：委婉、细致
- **情境匹配**：根据紧张程度调整对话

#### 修复示例
```
原内容：
李明说："我非常抱歉造成了这样的局面，我愿意承担所有责任。"

修复后：
李明低下头，声音有些哑："对不起……这事儿因我起的，责任我担。"

修改说明：
- 去除书面化表达（"非常抱歉"、"造成局面"）
- 增加动作描写（"低下头"，"声音有些哑"）
- 调整为口语化（"对不起"、"这事儿"、"责任我担"）
```

---

### 2. 节奏修复

#### 问题描述示例
- "此处节奏过慢"
- "叙述过于冗长"
- "信息密度过低"
- "高潮部分缺乏张力"

#### 修复策略
- **加快节奏**：
  - 删除冗余描述
  - 合并相似内容
  - 使用短句
  - 减少心理描写
- **减慢节奏**：
  - 增加细节描写
  - 扩展心理活动
  - 拆分长句为短句群
  - 增加环境描写

#### 修复示例
```
原内容：
李明慢慢地走在路上。他思考着刚才发生的一切，心情很沉重。他想到了很多问题，不知道该如何解决。阳光照在他身上，但他感觉不到温暖。

修复后：
李明步履沉重。刚才那一幕在他脑海里翻腾，问题压得他喘不过气。阳光虽暖，却照不进他心里的阴霾。

修改说明：
- 压缩冗余描述（"慢慢地走在路上" → "步履沉重"）
- 删除重复信息（删除"心情很沉重"，通过"喘不过气"表达）
- 加快叙述节奏（短句、紧凑）
```

---

### 3. 情感修复

#### 问题描述示例
- "情感转换生硬"
- "情感表达不足"
- "情感缺乏铺垫"
- "情感爆发不合理"

#### 修复策略
- **添加过渡**：在情感转换间添加过渡描写
- **增加铺垫**：在情感爆发前积累情绪
- **强化描写**：增加细节和心理描写
- **调整节奏**：用节奏控制情感强度

#### 修复示例
```
原内容：
李明听到了这个消息。他很生气。他大声说道："你怎么能这样做？"

修复后：
李明愣住了。这个消息像一记重锤砸在他心上。难以置信、愤怒、失望……种种情绪涌了上来。他的脸涨得通红，拳头捏得咯咯响，声音都在发抖："你怎么能这样做？！"

修改说明：
- 添加情感铺垫（"愣住"、"重锤"、"种种情绪涌了上来"）
- 增加细节描写（"脸涨得通红"、"拳头捏得咯咯响"、"声音发抖"）
- 强化情感表达（增加标点"？！"）
```

---

### 4. 表达修复

#### 问题描述示例
- "用词不当"
- "表达冗余"
- "描写不够生动"
- "句式单一"

#### 修复策略
- **替换词汇**：选择更准确的词汇
- **精简语句**：删除冗余表达
- **增加细节**：添加感官细节
- **丰富句式**：变化句式结构

#### 修复示例
```
原内容：
李明是一个非常聪明的人。他学习很努力。他经常取得好成绩。

修复后：
李明天资聪颖，又肯下苦功，成绩自然名列前茅。

修改说明：
- 替换词汇（"聪明" → "天资聪颖"、"努力" → "肯下苦功"）
- 精简语句（合并三句为一句）
- 丰富句式（使用四字成语）
```

---

### 5. 设定修复

#### 问题描述示例
- "设定前后不一致"
- "术语不统一"
- "描述相互矛盾"

#### 修复策略
- **统一描述**：将矛盾描述统一为一种
- **统一术语**：确保同一概念使用同一术语
- **添加说明**：在不一致处添加解释

#### 修复示例
```
原内容：
李明使用了他的"灵气"施展了法术。（第4章）
...
李明调动了体内的"真气"发动攻击。（第7章）

修复后（假设统一为"真气"）：
李明调动了体内的"真气"施展了法术。（第4章）
...
李明调动了体内的"真气"发动攻击。（第7章）

修改说明：
- 统一术语（将"灵气"改为"真气"）
- 保持一致（确保全文统一）
```

---

## 修复约束

### 必须遵守的约束
1. **保持原意**：修复不能改变原文的核心意思
2. **保持风格**：修复要符合原文的风格
3. **保持角色性格**：修复要符合角色的性格设定
4. **保持连贯性**：修复要确保前后文连贯

### 可选约束
1. **字数限制**：修复后字数不超过原文的120%
2. **结构调整**：是否允许调整句子结构
3. **内容增删**：是否允许增删内容

---

## 修复流程

### 步骤1：预处理修复任务
- 过滤掉 `可自动修复: false` 的任务（如果配置了跳过）
- 按优先级排序（A类 > B类 > C类）
- 检查任务位置是否已被前面的修复修改

### 步骤2：逐个执行修复
对每个任务：
1. 读取修改方案中的具体操作和修改后内容
2. 定位到目标位置
3. 应用修改（替换/调整/增加/删除）
4. 验证修复效果（保持原意、风格、角色性格、连贯性）
5. 记录修复结果

### 步骤3：处理修复冲突
- 如果目标位置已被修改，尝试调整位置或标记为失败
- 优先处理优先级高的任务
- 记录冲突情况

### 步骤4：生成修复后章节
- 按修复顺序应用所有成功的修改
- 生成完整的修复后章节内容

### 步骤5：生成修复报告
- 汇总修复统计
- 列出每个任务的修复结果
- 提供后续建议

---

## 批量修复策略

### 修复顺序
1. **按优先级**：A类（严重）→ B类（中等）→ C类（轻微）
2. **按位置**：从前往后（避免位置错乱）
3. **按类型**：先修复结构性问题（节奏、情节），再修复细节问题（对话、表达）

### 冲突处理
- **位置冲突**：如果两个任务修改同一位置，优先级高的先执行
- **内容冲突**：如果前一个修改改变了后一个修改的目标位置，标记为失败
- **验证失败**：如果验证不通过，回滚该修复

### 修复限制
- 单次最多修复50个任务
- 单个任务的修复时间不超过1分钟
- 如果修复失败率超过30%，停止并报告

---

## 注意事项

1. **精准修复**：只修复指定的内容，不修改其他部分
2. **保持谦逊**：不确定的修复不要强行执行
3. **详细说明**：清晰说明修复的操作和理由
4. **验证优先**：修复后必须验证各项指标
5. **透明化**：如实报告修复效果，不夸大

---

## 错误处理

| 错误类型 | 处理方式 |
|---------|---------|
| 目标位置找不到 | 返回失败，说明具体位置 |
| 修复指令不明确 | 返回失败，请求明确指令 |
| 违反约束条件 | 返回失败，说明违反了哪个约束 |
| 无法保持原意 | 返回失败，说明无法在不改变原意的情况下修复 |
| 上下文信息不足 | 返回失败，请求提供更多上下文 |

---

## 性能指标

- **平均修复时间**：<30秒
- **最大修复时间**：<1分钟
- **修复成功率**：>75%（针对可修复问题）
- **保持原意率**：>95%

---

## 相关Skill/Agent

### 接收修改方案自
- **dialogue_check** - 对话问题修改方案
- **rhythm_check** - 节奏问题修改方案
- **emotion_check** - 情感问题修改方案
- **theme_check** - 主题问题修改方案
- **logic_check** - 逻辑问题修改方案
- **setting_check** - 设定问题修改方案
- **plot_check** - 情节问题修改方案
- **character_consistency_check** - 角色问题修改方案
- **timeline_check** - 时间线问题修改方案
- **world_consistency** - 世界观问题修改方案

### 输出到
- **quality_fixer_agent** - 修复后章节和修复报告

### 协作流程
```
检查Skill发现问题 → 生成修改方案 → quality_fixer_agent收集 → auto_fix批量执行 → 输出修复后章节
```
