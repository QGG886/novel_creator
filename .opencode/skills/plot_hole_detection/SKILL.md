# 情节漏洞检测工具

## 功能
自动检测故事中的情节漏洞、逻辑矛盾和不合理之处，提供详细的漏洞分析和修复建议。

## 使用场景
- 大纲设计完成后，进行漏洞预检
- 章节创作过程中，进行阶段性检查
- 完成部分或全部内容后，进行全面排查
- 用户反馈情节问题后，进行针对性检查

## 输入格式
```json
{
  "检查范围": "大纲/部分章节/全部章节",
  "大纲": "大纲内容（如检查大纲）",
  "已写章节": ["章节1", "章节2"],
  "角色卡": {"角色1": "信息", "角色2": "信息"},
  "世界观": "世界观设定",
  "重点关注": ["逻辑", "设定", "角色", "时间"]
}
```

## 输出格式
```json
{
  "状态": "成功",
  "漏洞清单": [
    {
      "漏洞ID": 1,
      "类型": "逻辑漏洞/设定漏洞/情节漏洞/角色漏洞/时间漏洞",
      "严重程度": "严重/中等/轻微",
      "位置": {
        "范围": "第X卷第Y章",
        "具体位置": "第Z段或具体描述"
      },
      "问题描述": "详细描述漏洞内容",
      "问题分析": {
        "原因": "为什么会出现这个漏洞",
        "影响": "这个问题对故事的影响"
      },
      "修复建议": {
        "方案1": "修复方案1",
        "方案2": "修复方案2"
      },
      "修复难度": "低/中/高",
      "优先级": "高/中/低"
    }
  ],
  "统计信息": {
    "总漏洞数": 10,
    "严重漏洞": 2,
    "中等漏洞": 5,
    "轻微漏洞": 3
  },
  "优先修复": ["漏洞ID1", "漏洞ID2"]
}
```

## 漏洞类型

### 1. 逻辑漏洞
- 因果关系不成立
- 行为动机不合理
- 事件发展缺乏依据
- 逻辑链条断裂

### 2. 设定漏洞
- 设定前后矛盾
- 未解释的能力来源
- 未解释的知识来源
- 规则违反无解释

### 3. 情节漏洞
- 未解决的伏笔
- 未解释的关键信息
- 突然出现的解法
- 缺少铺垫的转折

### 4. 角色漏洞
- 角色行为OOC
- 能力突然变化
- 记忆出现问题
- 角色关系矛盾

### 5. 时间漏洞
- 时间线矛盾
- 时间顺序错误
- 时间跨度不合理
- 年龄计算错误

## 检测方法

### 1. 逻辑检测
- 追踪因果关系链
- 验证每个行为的动机
- 检查事件发展的合理性
- 识别逻辑跳跃

### 2. 设定检测
- 对比相同设定的不同描述
- 验证能力/物品的来源
- 检查规则的遵守情况
- 标记未解释的设定

### 3. 情节检测
- 追踪伏笔的回收情况
- 检查关键信息的解释
- 验证转折的铺垫
- 识别突然的解法

### 4. 角色检测
- 对比角色行为与性格
- 追踪角色能力的变化
- 检查角色记忆的一致性
- 验证角色关系的描述

### 5. 时间检测
- 绘制时间线图
- 验证事件的时间顺序
- 检查时间跨度的合理性
- 验证人物年龄的准确性

## 检查清单

### 逻辑检查
- [ ] 所有事件都有合理的因果
- [ ] 角色行为有充分动机
- [ ] 事件发展有依据
- [ ] 无明显的逻辑跳跃
- [ ] 结局合理

### 设定检查
- [ ] 设定前后一致
- [ ] 能力来源有说明
- [ ] 知识来源有解释
- [ ] 规则遵守情况良好
- [ ] 设定使用合理

### 情节检查
- [ ] 伏笔有回收
- [ ] 关键信息有解释
- [ ] 转折有铺垫
- [ ] 解法有依据
- [ ] 情节完整

### 角色检查
- [ ] 角色行为符合性格
- [ ] 角色能力一致
- [ ] 角色记忆一致
- [ ] 角色关系一致
- [ ] 角色发展合理

### 时间检查
- [ ] 时间线连贯
- [ ] 事件顺序正确
- [ ] 时间跨度合理
- [ ] 年龄计算准确
- [ ] 时间标记正确

## 注意事项
1. 区分真实漏洞和艺术性留白
2. 考虑叙述者的可靠性
3. 留意有意为之的矛盾
4. 注意记忆的模糊性
5. 区分需要修复和建议修复
6. 提供具体的修复方案
7. 考虑修复的可行性
8. 评估修复的影响范围
9. 遵循COMMON.md的输出规范
