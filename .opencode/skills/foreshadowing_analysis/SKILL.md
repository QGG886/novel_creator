# 伏笔分析Skill

## 功能
分析本章大纲和前后章节大纲，识别需要在本章埋入或回收的伏笔，确保故事情节的连贯性和深度。

## 使用场景
- 创作任何新章节前
- 确保伏笔的合理埋设和回收
- 检查情节的逻辑连贯性
- 增强故事的可读性和吸引力

## 输入格式
```json
{
  "当前章节信息": {
    "章节号": 4,
    "章节大纲": "第4章的大纲内容",
    "关键角色": ["角色1", "角色2", "角色3"]
  },
  "前后章节大纲": {
    "前两章大纲": [
      {
        "章节号": 2,
        "大纲": "第2章大纲内容"
      },
      {
        "章节号": 3,
        "大纲": "第3章大纲内容"
      }
    ],
    "后两章大纲": [
      {
        "章节号": 5,
        "大纲": "第5章大纲内容"
      },
      {
        "章节号": 6,
        "大纲": "第6章大纲内容"
      }
    ]
  },
  "已写章节": [
    {
      "章节号": 1,
      "文件路径": "output/chapters/第1卷_第1章_六人奇遇.md"
    },
    {
      "章节号": 2,
      "文件路径": "output/chapters/第1卷_第2章_初见炊烟.md"
    },
    {
      "章节号": 3,
      "文件路径": "output/chapters/第1卷_第3章_初入村寨.md"
    }
  ],
  "本卷大纲": "第1卷的完整大纲内容"
}
```

## 输出格式
```json
{
  "状态": "成功",
  "前文伏笔分析": {
    "已埋伏笔": [
      {
        "伏笔内容": "荆杨的观察力和逻辑能力",
        "所在章节": 1,
        "回收状态": "未回收",
        "建议回收时机": "后续危机中展现"
      },
      {
        "伏笔内容": "赵奇的医术和知识储备",
        "所在章节": 1,
        "回收状态": "未回收",
        "建议回收时机": "遇到伤病时展现"
      }
    ],
    "待回收伏笔": ["伏笔1", "伏笔2"],
    "建议在本章回收的伏笔": [
      {
        "伏笔内容": "某个伏笔",
        "回收方式": "如何在本章中回收",
        "回收场景": "具体场景"
      }
    ]
  },
  "本章伏笔设计": {
    "需要埋入的伏笔": [
      {
        "伏笔内容": "为后续章节做铺垫",
        "埋入方式": "如何在本章中埋入",
        "埋入场景": "具体场景",
        "预期回收章节": 7
      },
      {
        "伏笔内容": "另一个伏笔",
        "埋入方式": "如何在本章中埋入",
        "埋入场景": "具体场景",
        "预期回收章节": 8
      }
    ],
    "伏笔类型": [
      {
        "类型": "细节伏笔",
        "示例": "某个物品或细节",
        "作用": "后续关键作用"
      },
      {
        "类型": "对话伏笔",
        "示例": "某句看似无意的对话",
        "作用": "暗示后续发展"
      },
      {
        "类型": "情节伏笔",
        "示例": "某个未解的疑问",
        "作用": "推动后续剧情"
      }
    ]
  },
  "情节连贯性分析": {
    "前文情节": ["情节1", "情节2", "情节3"],
    "本章情节": ["情节4", "情节5"],
    "后文情节": ["情节6", "情节7"],
    "连贯性评估": "连贯/部分连贯/不连贯",
    "需要调整的情节": ["情节调整建议1", "情节调整建议2"]
  },
  "创作建议": {
    "关于前文伏笔": ["建议1", "建议2"],
    "关于本章伏笔": ["建议1", "建议2"],
    "关于情节连贯": ["建议1", "建议2"],
    "避免事项": ["避免1", "避免2"]
  },
  "潜在风险": [
    "风险1：伏笔埋设过于明显",
    "风险2：伏笔回收过于突兀",
    "风险3：伏笔与主线剧情脱节"
  ]
}
```

## 分析维度

### 1. 前文伏笔分析
- **已埋伏笔**：从前文中识别出所有已埋设的伏笔
  - 伏笔内容
  - 所在章节
  - 回收状态（已回收/未回收/部分回收）
  - 建议回收时机

- **待回收伏笔**：尚未回收的伏笔
  - 按紧急程度排序
  - 识别适合在本章回收的伏笔

- **建议回收方式**：
  - 如何在本章中自然回收
  - 回收的具体场景
  - 回收的合理性

### 2. 本章伏笔设计
- **需要埋入的伏笔**：
  - 伏笔内容
  - 埋入方式（细节/对话/情节/象征）
  - 埋入场景
  - 预期回收章节

- **伏笔类型**：
  - **细节伏笔**：某个物品、特征或细节
  - **对话伏笔**：某句看似无意的对话
  - **情节伏笔**：某个未解的疑问或事件
  - **象征伏笔**：某个象征性的场景或物品
  - **角色伏笔**：角色的某个特质或动机

- **伏笔设计原则**：
  - 自然不突兀
  - 符合当前情节
  - 有回收价值
  - 不影响当前主线

### 3. 情节连贯性分析
- **前文情节**：前两章的关键情节
- **本章情节**：本章的主要情节
- **后文情节**：后两章的主要情节
- **连贯性评估**：
  - 时间线连贯
  - 逻辑连贯
  - 人物行为连贯
  - 设定连贯

### 4. 本章伏笔与主线关系
- **主情节相关伏笔**：直接推动主情节
- **支情节相关伏笔**：推动支情节
- **角色相关伏笔**：关于角色发展的伏笔
- **世界观相关伏笔**：关于世界设定的伏笔

## 检查清单

### 伏笔合理性
- [ ] 伏笔埋设自然，不生硬
- [ ] 伏笔有明确的回收价值
- [ ] 伏笔回收时机合理
- [ ] 伏笔与主线剧情相关

### 情节连贯性
- [ ] 伏笔埋设符合当前情节
- [ ] 伏笔回收符合逻辑
- [ ] 情节发展连贯无断层
- [ ] 人物行为符合设定

### 伏笔多样性
- [ ] 伏笔类型多样（细节/对话/情节等）
- [ ] 伏笔涉及角色、情节、世界观等多个维度
- [ ] 伏笔埋设方式不单一

### 可读性
- [ ] 伏笔埋设不过于明显
- [ ] 伏笔回收不过于突兀
- [ ] 伏笔不影响当前阅读体验

## 使用流程

### 第一步：读取输入信息
- 读取当前章节信息（章节号、大纲、关键角色）
- 读取前后章节大纲
- 读取已写章节内容
- 读取本卷大纲

### 第二步：分析前文伏笔
- 从已写章节中提取所有已埋伏笔
- 标记每个伏笔的回收状态
- 识别适合在本章回收的伏笔
- 设计回收方式和场景

### 第三步：设计本章伏笔
- 根据本章大纲和后文大纲，设计需要埋入的伏笔
- 选择伏笔类型和埋入方式
- 确定埋入场景和预期回收时机
- 确保伏笔符合当前情节

### 第四步：分析情节连贯性
- 分析前文、本章、后文的情节关系
- 评估情节的连贯性
- 识别需要调整的情节
- 提供调整建议

### 第五步：生成创作建议
- 关于前文伏笔的建议
- 关于本章伏笔的建议
- 关于情节连贯的建议
- 列出避免事项

### 第六步：识别潜在风险
- 识别伏笔埋设过于明显的风险
- 识别伏笔回收过于突兀的风险
- 识别伏笔与主线脱节的风险
- 提供风险规避建议

## 常见错误

### 伏笔埋设错误
- **过于明显**：读者一眼就能看出是伏笔
- **过于隐晦**：埋设得过于隐晦，读者无法察觉
- **没有价值**：伏笔没有回收价值或回收意义不大
- **与情节脱节**：伏笔与当前情节无关，显得突兀

### 伏笔回收错误
- **回收突兀**：回收时读者没有印象
- **回收不当**：回收方式不合理
- **回收过晚**：伏笔拖得太久才回收
- **回收过早**：伏笔刚埋下就回收

### 情节连贯错误
- **情节断层**：情节发展不连贯
- **逻辑矛盾**：前后情节矛盾
- **人物OOC**：为了埋设或回收伏笔让人物行为OOC
- **设定冲突**：伏笔与设定冲突

## 注意事项
1. 仔细阅读前文内容，确保不遗漏伏笔
2. 伏笔埋设要自然，不要刻意
3. 伏笔回收要合理，不要突兀
4. 确保伏笔与主线剧情相关
5. 注意伏笔的多样性，不要单一
6. 避免过度埋设伏笔，影响阅读体验
7. 识别潜在风险，提前规避
8. 保持客观，不要带入主观判断

## 与其他Skill的配合

- **chapter_context_analysis**：使用前文伏笔分析结果
- **skeleton_outline**：在本章伏笔设计中埋入伏笔
- **chapter_write**：在创作时埋设和回收伏笔
- **plot_hole_detection**：检查伏笔回收后是否有情节漏洞
- **continuity_agent**：确保伏笔回收后的连贯性

## 示例输出

```json
{
  "状态": "成功",
  "前文伏笔分析": {
    "已埋伏笔": [
      {
        "伏笔内容": "荆杨的观察力和逻辑能力",
        "所在章节": 1,
        "回收状态": "未回收",
        "建议回收时机": "后续危机中展现"
      },
      {
        "伏笔内容": "赵奇的医术和知识储备",
        "所在章节": 1,
        "回收状态": "未回收",
        "建议回收时机": "遇到伤病时展现"
      },
      {
        "伏笔内容": "李辉辉的农业知识",
        "所在章节": 1,
        "回收状态": "部分回收",
        "建议回收时机": "在村寨中继续展现"
      }
    ],
    "待回收伏笔": [
      "荆杨的观察力和逻辑能力",
      "赵奇的医术和知识储备"
    ],
    "建议在本章回收的伏笔": [
      {
        "伏笔内容": "赵奇的医术和知识储备",
        "回收方式": "村长提到有人生病时，赵奇主动提出帮忙",
        "回收场景": "在村长家中交谈时"
      }
    ]
  },
  "本章伏笔设计": {
    "需要埋入的伏笔": [
      {
        "伏笔内容": "村寨面临外部威胁",
        "埋入方式": "对话伏笔",
        "埋入场景": "村民的担忧神态和零星对话",
        "预期回收章节": 7
      },
      {
        "伏笔内容": "附近有重要的军事据点",
        "埋入方式": "细节伏笔",
        "埋入场景": "看到远处的军旗或听到军号",
        "预期回收章节": 8
      }
    ],
    "伏笔类型": [
      {
        "类型": "对话伏笔",
        "示例": "村民提到最近有些不安",
        "作用": "暗示村寨面临威胁"
      },
      {
        "类型": "细节伏笔",
        "示例": "村长办公桌上的书信",
        "作用": "暗示有重要消息"
      }
    ]
  },
  "情节连贯性分析": {
    "前文情节": [
      "穿越到三国时期",
      "六人相遇",
      "编造身份进入村寨"
    ],
    "本章情节": [
      "与村长交谈",
      "了解村寨情况",
      "展现部分能力"
    ],
    "后文情节": [
      "接触蜀军",
      "卷入三国争霸",
      "各展其能"
    ],
    "连贯性评估": "连贯",
    "需要调整的情节": []
  },
  "创作建议": {
    "关于前文伏笔": [
      "在本章中让赵奇展现医术，回收第1章的伏笔",
      "保持荆杨的观察力，为后续回收做准备"
    ],
    "关于本章伏笔": [
      "通过村民的担忧埋下村寨面临威胁的伏笔",
      "通过细节暗示附近有军事据点"
    ],
    "关于情节连贯": [
      "确保六人的身份保持一致",
      "确保时间线连贯"
    ],
    "避免事项": [
      "不要让赵奇的能力过于突然展现",
      "不要让伏笔过于明显",
      "不要为了埋伏笔而影响当前情节"
    ]
  },
  "潜在风险": [
    "风险1：伏笔埋设过于明显，读者一眼就能看出",
    "风险2：伏笔回收过于突兀，读者没有印象",
    "风险3：伏笔与主线剧情脱节，影响阅读体验"
  ]
}
```

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| 1.0 | 2026-01-29 | 初始版本，建立伏笔分析功能 |
