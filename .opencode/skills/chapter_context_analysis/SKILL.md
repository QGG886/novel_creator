# 章节上下文分析Skill

## 功能
在创作新章节前，自动分析前两章的剧情内容和下一章的大纲，提取关键信息，避免重复和逻辑冲突，确保当前章的开头顺应上一章，结尾衔接下一章。

## 使用场景
- 创作任何新章节前（从第3章开始）
- 确保剧情连贯性
- 避免重复和逻辑冲突
- 保持角色行为一致
- 确保章节之间的自然衔接（开头承接上一章，结尾衔接下一章）

## 输入格式
```json
{
  "当前章节号": 4,
  "章节大纲": "第4章的大纲内容",
  "下一章大纲": "第5章的大纲内容（如果是最后一章则为null）",
  "已写章节": [
    {
      "章节号": 1,
      "文件路径": "output/chapters/第1卷_第1章_六人奇遇.md"
    },
    {
      "章节号": 2,
      "文件路径": "output/chapters/第1卷_第2章_初见炊烟.md"
    }
  ]
}
```

## 输出格式
```json
{
  "状态": "成功",
  "前两章剧情提炼": {
    "第1章关键点": ["点1", "点2"],
    "第2章关键点": ["点1", "点2"],
    "当前时间线": "第2天清晨",
    "当前地点": "村寨中",
    "角色状态": {
      "荆杨": "状态",
      "孟茹": "状态",
      "李辉辉": "状态",
      "赵奇": "状态",
      "司马德恩": "状态",
      "杨迪": "状态"
    },
    "已埋伏笔": ["伏笔1", "伏笔2"],
    "已解决情节": ["情节1"],
    "待解决情节": ["情节2"]
  },
  "下一章衔接分析": {
    "下一章时间线": "第2天下午",
    "下一章地点": "村长家中",
    "下一章主要事件": ["事件1", "事件2"],
    "下一章关键角色": ["角色1", "角色2"],
    "需要为本章结尾铺垫的内容": ["铺垫1", "铺垫2"],
    "避免在本章结尾解决的问题": ["问题1", "问题2"],
    "需要为下一章预留的信息": ["信息1", "信息2"]
  },
  "创作指导": {
    "开头应承接": "如何承接第2章结尾",
    "核心冲突设计": "设计核心冲突细节",
    "结尾应铺垫": "如何为下一章做铺垫",
    "需要避免的内容": [
      "重复分析时代",
      "重复介绍角色",
      "前后矛盾"
    ],
    "保持一致的关键点": ["点1", "点2"],
    "需要推进的情节": ["情节1", "情节2"],
    "需要埋下的伏笔": ["伏笔1", "伏笔2"]
  },
  "潜在风险": ["风险1", "风险2"]
}
```

## 关键信息提取维度

### 1. 时间线
- 第1章时间点
- 第2章时间点
- 当前时间点（前两章结尾）
- 时间跨度

### 2. 地点信息
- 第1章地点
- 第2章地点
- 当前地点（前两章结尾）
- 地点转换

### 3. 角色状态
- 每个角色的当前位置
- 每个角色的心理状态
- 每个角色的已知信息
- 角色之间的关系进展

### 4. 情节进展
- 已完成的事件
- 正在进行的事件
- 待解决的事件
- 情节主线推进

### 5. 伏笔和悬念
- 已埋伏笔
- 已回收伏笔
- 待回收伏笔
- 当前悬念

### 6. 信息知晓度
- 每个角色已知什么
- 每个角色未知什么
- 读者已知什么
- 读者未知什么

### 7. 下一章信息分析
- 下一章时间线和地点
- 下一章主要事件和角色
- 需要在本章结尾铺垫的内容
- 避免在本章结尾解决的问题
- 需要为下一章预留的信息
- 下一章需要的当前状态

## 检查清单

### 时间线连贯性
- [ ] 时间推进合理
- [ ] 没有时间跳跃或倒退
- [ ] 时间标记一致

### 地点连贯性
- [ ] 地点转换合理
- [ ] 没有空间跳跃
- [ ] 环境描述一致

### 角色一致性
- [ ] 角色行为符合性格
- [ ] 角色知识水平一致
- [ ] 角色记忆一致
- [ ] 角色关系发展合理

### 情节连贯性
- [ ] 情节推进有逻辑
- [ ] 没有重复情节
- [ ] 没有情节遗漏
- [ ] 没有前后矛盾

### 信息一致性
- [ ] 没有信息突然出现
- [ ] 没有信息突然消失
- [ ] 信息获取合理
- [ ] 信息使用合理

## 创作指导生成

### 开头建议
- 如何承接上一章结尾
- 如何介绍当前时间和地点
- 如何避免重复前文信息

### 结尾建议（新增）
- 如何为下一章做铺垫
- 如何设置悬念或钩子
- 如何确保下一章能够自然衔接
- 避免在本章结尾解决的问题
- 预留下一章需要的信息

### 情节推进建议
- 哪些情节需要推进
- 哪些情节需要暂停
- 哪些情节需要解决
- 哪些情节需要埋伏笔

### 角色发展建议
- 哪些角色需要发展
- 哪些角色关系需要推进
- 哪些角色内心需要揭示

### 需要避免的内容
- 重复分析前文已分析的内容
- 重复介绍前文已介绍的信息
- 与前文矛盾的描述
- 不符合角色性格的行为
- 提前解决下一章应该解决的问题
- 在结尾留下无法衔接的悬念

## 潜在风险识别

### 常见风险类型
1. **重复风险**：重复前文的描写、对话或分析
2. **矛盾风险**：与前文的时间、地点、信息不符
3. **OOC风险**：角色行为不符合性格设定
4. **信息跳跃风险**：信息突然出现或消失
5. **情节遗漏风险**：遗漏前文埋下的伏笔
6. **章节衔接风险**：结尾与下一章无法自然衔接
7. **信息提前风险**：在本章解决了下一章应该解决的问题

### 风险规避建议
- 避免重复前文的描述和对话
- 仔细核对时间、地点、信息的一致性
- 确保角色行为符合性格设定
- 信息获取要合理，不要突然出现
- 记得回收前文埋下的伏笔
- 确保结尾为下一章做好铺垫
- 不要提前解决下一章的关键问题
- 预留下一章需要的信息和状态

## 使用流程

### 第一步：读取前两章内容和下一章大纲
- 读取第N-2章内容
- 读取第N-1章内容
- 读取第N+1章大纲（如果存在）

### 第二步：提取关键信息
- 提取时间线信息
- 提取地点信息
- 提取角色状态
- 提取情节进展
- 提取伏笔和悬念
- 提取下一章大纲信息（时间、地点、主要事件、关键角色）

### 第三步：生成剧情提炼
- 总结前两章关键点
- 明确当前时间线
- 明确当前地点
- 明确角色状态
- 列出已埋伏笔
- 列出待解决情节

### 第四步：生成下一章衔接分析
- 分析下一章的时间线和地点
- 提取下一章的主要事件和关键角色
- 识别需要在本章结尾铺垫的内容
- 识别应避免在本章结尾解决的问题
- 识别需要为下一章预留的信息

### 第五步：生成创作指导
- 生成开头建议（承接上一章）
- 生成结尾建议（铺垫下一章）
- 生成情节推进建议
- 生成角色发展建议
- 列出需要避免的内容
- 列出保持一致的关键点
- 列出需要埋下的伏笔

### 第六步：识别潜在风险
- 识别可能的重复风险
- 识别可能的矛盾风险
- 识别可能的OOC风险
- 识别结尾衔接不当的风险
- 提供风险规避建议

## 输出示例

```json
{
  "状态": "成功",
  "前两章剧情提炼": {
    "第1章关键点": [
      "6人在城郊山坡观测日食",
      "看到七彩光环和强光",
      "穿越到陌生山林",
      "六人彼此不认识，只是偶然相遇"
    ],
    "第2章关键点": [
      "第二天清晨，继续探索",
      "发现远处有炊烟",
      "讨论是否接触",
      "编造身份（北边逃难过来的）",
      "准备进入村寨"
    ],
    "当前时间线": "第2天上午",
    "当前地点": "村寨附近的山坡上",
    "角色状态": {
      "荆杨": "保持警惕，逐渐展现领导能力",
      "孟茹": "有些不安，但跟随团队",
      "李辉辉": "活泼跳脱，话痨",
      "赵奇": "沉稳儒雅，善于分析",
      "司马德恩": "沉默寡言，偶尔说话很有分量",
      "杨迪": "老实踏实，话少"
    },
    "已埋伏笔": [
      "荆杨的观察力和逻辑能力开始显现",
      "赵奇的医术和知识储备",
      "李辉辉的农业知识",
      "司马德恩的沉默和心理变化初现端倪"
    ],
    "已解决情节": [
      "穿越原因（日食异象）",
      "穿越到古代（初步推断）"
    ],
    "待解决情节": [
      "确定具体时代（三国时期）",
      "接触蜀军或蜀民",
      "获得信任"
    ]
  },
  "下一章衔接分析": {
    "下一章时间线": "第2天下午",
    "下一章地点": "村长家中",
    "下一章主要事件": [
      "与村长深入交流",
      "了解到村寨面临的困难",
      "得知附近有蜀军驻扎"
    ],
    "下一章关键角色": ["村长", "荆杨", "赵奇"],
    "需要为本章结尾铺垫的内容": [
      "与村长建立初步信任",
      "暗示村寨面临的问题",
      "为下一章深入交流做铺垫"
    ],
    "避免在本章结尾解决的问题": [
      "不要在本章就透露蜀军信息",
      "不要在本章就解决村寨的困难",
      "不要让村长完全信任六人"
    ],
    "需要为下一章预留的信息": [
      "村寨的具体困难（留到下一章展开）",
      "蜀军驻扎的细节（留到下一章展开）",
      "村长的真实想法（留到下一章展现）"
    ]
  },
  "创作指导": {
    "开头应承接": "承接第2章结尾，六人准备进入村寨。先说明已到村寨门口，简要描述村寨外观。",
    "核心冲突设计": "村口守卫的盘查。六人需要用编造的身份应对，展现司马德恩的谈判能力和赵奇的配合。",
    "结尾应铺垫": "六人通过与村长的初步交谈，建立起基本的信任。结尾时让村长暗示村寨面临一些困难，但不要详细说明。同时，让六人感受到村长似乎有话要说，为下一章深入交流做好铺垫。",
    "需要避免的内容": [
      "不要再次分析这是什么时代（第1章已分析）",
      "不要再次介绍彼此的名字和背景（第1章已介绍）",
      "不要再次讨论穿越的原因（第1章已讨论）",
      "不要在本章结尾就透露蜀军信息",
      "不要让村长在本章就完全信任六人"
    ],
    "保持一致的关键点": [
      "六人彼此仍是陌生人，熟悉度有限",
      "时间线是第2天上午",
      "身份是北边逃难过来的",
      "司马德恩说话少但每句话有分量",
      "荆杨保持警惕和观察"
    ],
    "需要推进的情节": [
      "通过村口守卫的盘查",
      "进入村寨，见到村长",
      "初步建立信任",
      "为下一章深入了解做铺垫"
    ],
    "需要埋下的伏笔": [
      "村寨面临的困难（具体到下一章展开）",
      "附近可能有重要人物（为蜀军出现做铺垫）"
    ]
  },
  "潜在风险": [
    "风险1：村口守卫盘查时，六人的回答可能与编造的身份不一致",
    "风险2：村长的提问可能过于深入，导致编造的身份露出破绽",
    "风险3：村民对六人的陌生穿着和行为可能过于警惕",
    "风险4：结尾可能提前透露下一章的信息，导致下一章没有展开空间"
  ]
}
```

## 注意事项
1. 仔细阅读前两章内容，确保提取准确
2. 仔细阅读下一章大纲，确保衔接分析准确
3. 关注细节，避免遗漏重要信息
4. 生成创作指导时要具体、可操作
5. 开头建议要确保承接上一章的自然流畅
6. 结尾建议要确保为下一章做好铺垫
7. 识别潜在风险时要全面，包括章节衔接风险
8. 保持客观，不要带入主观判断
9. 确保输出格式规范，便于后续使用

## 与其他Skill的配合

- **chapter_write**：使用本Skill生成的创作指导（包括开头和结尾建议）来创作新章节
- **dialogue_naturalization**：在创作后检查对话自然度
- **plot_hole_detection**：在创作后检查情节漏洞，特别是章节衔接处的漏洞
- **outline_refine**：确保章节与大纲一致，并与下一章大纲协调
- **pacing_analysis**：检查章节节奏，确保结尾不会过于突兀或过于拖沓

## 常见错误

### 提取错误
- 遗漏重要信息
- 提取不准确的信息
- 曲解原文意思
- 下一章大纲分析不准确

### 指导错误
- 指导不够具体
- 指导与大纲不一致
- 指导与角色设定矛盾
- 结尾建议没有为下一章做好铺垫
- 开头建议没有承接上一章

### 衔接错误
- 结尾与下一章无法自然衔接
- 提前解决了下一章应该解决的问题
- 没有为下一章预留足够的信息
- 结尾的悬念无法在下一章展开

### 风险识别错误
- 遗漏潜在风险
- 风险识别不准确
- 风险规避建议不可行
- 忽略了章节衔接风险

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| 1.0 | 2026-01-28 | 初始版本，建立章节上下文分析功能 |
| 1.1 | 2026-01-28 | 增加下一章大纲分析，确保当前章结尾能够衔接下一章 |
